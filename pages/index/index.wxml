<!-- 游戏中心首页 -->
<view class="game-container">
  
  <!-- 轮播图区域 -->
  <view class="carousel-section">
    <swiper class="game-swiper" indicator-dots="true" indicator-active-color="#e64340" autoplay circular>
      <swiper-item wx:for="{{banners}}" wx:key="id">
        <image 
          mode="aspectFill" 
          bindtap="tapBanner" 
          data-item="{{ item }}" 
          src="{{item.picUrl}}" 
          class="carousel-image"
        />
      </swiper-item>
    </swiper>
  </view>

  <!-- 商品分类入口区域 -->
  <view class="entry-section">
    <view class="entry-grid">
      <!-- 动态显示商品分类，但名称固定 -->
      <view 
        class="entry-item" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="onCategoryClick"
        data-id="{{item.id}}"
        data-name="{{item.name}}"
      >
        <view class="entry-icon category-icon">
          <image 
            src="{{item.icon || '/images/default.png'}}" 
            class="category-image"
            mode="aspectFill"
          />
        </view>
        <!-- 根据索引显示固定名称 -->
        <text class="entry-title">{{index === 0 ? '积分兑换礼品' : '积分兑换联盟'}}</text>
      </view>
      
      <!-- 如果分类少于2个，显示默认入口 -->
      <view class="entry-item" wx:if="{{categories.length < 2}}" bindtap="goAllCategories">
        <view class="entry-icon all-categories">
          <van-icon name="apps-o" size="80" color="#fff" />
        </view>
        <text class="entry-title">全部分类</text>
      </view>
    </view>
  </view>

  <!-- 充值规则板块 -->
  <view class="recharge-rules-section" wx:if="{{rechargeSendRules && rechargeSendRules.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="balance-o" size="20" color="#ff9800" />
        <text>会员充值</text>
      </view>
    </view>
    
    <view class="recharge-rules-grid">
      <view 
        class="recharge-rule-item" 
        wx:for="{{rechargeSendRules}}" 
        wx:key="id"
        bindtap="goRecharge"
        data-confine="{{item.confine}}"
        data-send="{{item.send}}"
      >
        <!-- 左侧充值金额 -->
        <view class="rule-left">
          <view class="rule-label">充值金额</view>
          <view class="rule-amount">¥{{item.confine}}</view>
        </view>
        
        <!-- 中间赠送信息 -->
        <view class="rule-center">
          <view class="rule-arrow" wx:if="{{item.send && item.send > 0}}">
            <view class="arrow-icon">+</view>
          </view>
          <view class="rule-send-big" wx:if="{{item.send && item.send > 0}}">
            <view class="send-label">额外赠送</view>
            <view class="send-amount">¥{{item.send}}</view>
          </view>
          <view class="no-gift" wx:else>
            <view class="arrow-icon">→</view>
          </view>
        </view>
        
        <!-- 右侧等号 -->
        <view class="equal-sign">
          <view class="equal-icon">=</view>
        </view>
        
        <!-- 右侧总金额 -->
        <view class="rule-right">
          <view class="total-section" wx:if="{{item.send && item.send > 0}}">
            <view class="total-label">实际到账</view>
            <view class="total-amount">¥{{item.confine + item.send}}</view>
          </view>
          <view class="total-section" wx:else>
            <view class="total-label">实际到账</view>
            <view class="total-amount">¥{{item.confine}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 会员充值板块 -->
  <view class="membership-section">
    <view class="section-header">
      <view class="section-title">
        <van-icon name="diamond-o" size="20" color="#e64340" />
        <text>弹珠购买</text>
      </view>
      <view class="refresh-btn" bindtap="refreshMembershipPackages" wx:if="{{!loading}}">
        <van-icon name="replay" size="16" color="#999" />
      </view>
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{loading}}">
      <van-loading size="24" color="#e64340">加载中...</van-loading>
    </view>
    
    <!-- 商品列表 -->
    <view class="membership-grid" wx:elif="{{membershipPackages.length > 0}}">
      <view 
        class="package-item" 
        wx:for="{{membershipPackages}}" 
        wx:key="id"
        bindtap="onPackageClick"
        data-package="{{item}}"
      >
        <!-- 左侧商品信息 -->
        <view class="package-left">
          <view class="package-title">{{item.title}}</view>
          <view class="package-description" wx:if="{{item.description}}">
            {{item.description}}
          </view>
          <view class="package-tags" wx:if="{{item.tags}}">
            <text class="tag">{{item.tags}}</text>
          </view>
        </view>
        
        <!-- 中间价格 -->
        <view class="package-center">
          <view class="price-container">
            <view class="member-price-label">¥{{item.minPrice}}</view>
          </view>
          <view class="original-price" wx:if="{{item.originalPrice && item.originalPrice != item.minPrice}}">
           ¥{{item.originalPrice}}
          </view>
          
        </view>
        
        <!-- 右侧按钮 -->
        <view class="package-right">
          <van-button 
            type="primary" 
            size="small" 
            round
            custom-style="background: linear-gradient(135deg, #e64340 0%, #ff8a80 100%); border: none;"
          >
            立即购买
          </van-button>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-container" wx:else>
      <van-empty description="暂无充值商品" />
    </view>
  </view>

</view>

<!-- 弹出编辑昵称和头像的框 -->
<login show="{{ nickPopShow }}" avatarUrl="{{ popavatarUrl }}" name="{{ popnick }}" />

<!-- 绑定手机号弹窗 -->
<bind-mobile
  title="绑定手机号码"
  alarmText="为保障您的资金安全，请先绑定手机号码"
  show="{{ bindMobileShow }}"
  bind:cancel="bindMobileCancel"
  bind:ok="bindMobileOk"
/>

<!-- 支付弹窗 -->
<payment
  money="{{ amount }}"
  remark="在线充值{{ amount }}"
  show="{{ paymentShow }}"
  bind:cancel="paymentCancel"
  bind:ok="paymentOk"
/>